# Инструкции по развертыванию

## 1. Backend - исправление CORS

Backend был обновлен для корректной обработки CORS запросов.

### Изменения:
- `backend/api/index.js` - добавлена явная обработка OPTIONS запросов
- `backend/vercel.json` - упрощена конфигурация
- Добавлен новый модуль `AIAssistantModule` для работы с DeepSeek

### Деплой на Vercel:

```bash
cd backend
vercel --prod
```

Или через Git:
```bash
git add backend/
git commit -m "Fix CORS and add AI Assistant module"
git push
```

## 2. Frontend - новый AI-ассистент

Frontend собран и готов к деплою.

### Что нового:
- Компактный AI-ассистент вместо большой боковой панели
- Локальная логика без вызовов LLM
- Интеграция с DeepSeek по запросу
- Кэширование ответов

### Переменные окружения (опционально):

Для работы глубокого анализа DeepSeek добавьте в Vercel Environment Variables:

```
DEEPSEEK_API_KEY=your_api_key_here
```

**Без этой переменной AI продолжит работать локально с подсказками и шаблонами.**

## 3. Проверка после деплоя

1. Откройте админ-панель → Контент
   - Должны загружаться обновления без CORS ошибок

2. Откройте чат с любым пользователем
   - Нажмите кнопку с иконкой бота рядом с полем ввода
   - Должен открыться компактный AI-ассистент
   - Попробуйте вкладки "Подсказки", "Шаблоны", "Анализ"
   - Нажмите на любой шаблон - текст вставится в поле ввода

3. (Опционально) Если настроен DEEPSEEK_API_KEY:
   - На вкладке "Анализ" нажмите "Сводка" или "Риски"
   - Должен появиться toast с ответом от DeepSeek

## Troubleshooting

### CORS ошибки в админ-панели
- Убедитесь что backend задеплоен с новыми изменениями
- Проверьте что `backend/api/index.js` содержит обработку OPTIONS

### AI-ассистент не открывается
- Очистите кэш браузера
- Проверьте консоль браузера на ошибки
- Убедитесь что frontend собран с последними изменениями

### DeepSeek не работает
- Это нормально! DeepSeek опционален
- Локальные подсказки работают без API ключа
- Для глубокого анализа нужен `DEEPSEEK_API_KEY` в backend

## Что работает без настройки

- Локальный анализ диалога
- Определение этапа переговоров
- Подсказки и шаблоны ответов
- Выявление рисков
- Чек-листы

## Что требует DEEPSEEK_API_KEY

- Кнопка "Сводка" (детальная сводка договоренностей)
- Кнопка "Риски" (глубокий анализ рисков)
- Улучшение сообщений

**Без API ключа эти кнопки покажут уведомление "DeepSeek не настроен"**
