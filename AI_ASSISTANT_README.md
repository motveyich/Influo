# AI-Ассистент для платформы Influo

## Обзор

Новый AI-ассистент - это компактный, умный и экономичный помощник для переговоров между инфлюенсерами и рекламодателями.

## Ключевые особенности

### 1. Компактный UI
- Кнопка AI рядом с полем ввода сообщений
- Компактное всплывающее окно (~30% экрана)
- Не отправляет сообщения автоматически
- Предлагает варианты, которые пользователь вставляет вручную

### 2. Локальная логика без LLM
По умолчанию AI работает **полностью локально** без вызовов к DeepSeek:
- Анализирует этап переговоров (начало, обсуждение, активное сотрудничество, завершение)
- Определяет что обсуждено (цена, сроки, задачи, согласие)
- Выявляет недостающие элементы договоренностей
- Подсвечивает возможные риски
- Предлагает шаблоны ответов
- Дает чек-листы для каждого этапа

**Токены не тратятся!**

### 3. DeepSeek только по запросу
LLM вызывается только при явном действии пользователя:
- Кнопка "Сводка" - краткая сводка всех договоренностей
- Кнопка "Риски" - детальный анализ рисков
- Минимальный контекст (последние 10 сообщений)
- Кэширование ответов на 30 минут
- Автоматическая очистка старых записей кэша

### 4. Умное понимание контекста

AI автоматически определяет:
- **Начало общения** - предлагает представиться и уточнить базовые условия
- **Обсуждение условий** - помогает зафиксировать цену, сроки, задачи
- **Активное сотрудничество** - напоминает держать партнера в курсе
- **Завершение** - предлагает попросить отзыв

## Архитектура

### Frontend
```
src/modules/chat/
├── components/
│   ├── CompactAIAssistant.tsx    # Компактный UI компонент
│   └── ChatPage.tsx               # Интеграция в чат
├── services/
│   ├── aiLocalRules.ts           # Локальная логика (без LLM)
│   └── aiAssistantService.ts     # Сервис для DeepSeek
```

### Backend
```
backend/src/modules/ai-assistant/
├── ai-assistant.controller.ts    # REST API
├── ai-assistant.service.ts       # Логика + кэширование
└── dto/
    └── deepseek-request.dto.ts   # Типы запросов
```

## Использование

### 1. В чате нажмите кнопку с иконкой бота
### 2. Откроется компактное окно с тремя вкладками:

#### **Подсказки**
- Что нужно уточнить на текущем этапе
- Чек-листы для проверки
- Предупреждения о рисках

#### **Шаблоны**
- Готовые фразы для быстрых ответов
- Адаптируются к этапу переговоров
- Вставляются в поле ввода одним кликом

#### **Анализ**
- Что обсуждено, что не хватает
- Возможные риски
- Кнопки для глубокого анализа с DeepSeek

### 3. Нажмите на любой шаблон - текст вставится в поле ввода
### 4. Для глубокого анализа используйте кнопки "Сводка" или "Риски"

## Экономия токенов

### Локальная логика (0 токенов)
- Определение этапа переговоров
- Проверка наличия ключевых элементов (цена, сроки, задачи)
- Выявление рисков по ключевым словам
- Генерация шаблонов ответов
- Быстрые подсказки

### DeepSeek (~500 токенов на запрос)
- Только по кнопкам "Сводка" / "Риски"
- Передаются последние 10 сообщений
- Кэш на 30 минут
- Максимум 500 токенов в ответе

**Экономия: 90%+ токенов по сравнению со старым подходом**

## Настройка DeepSeek (опционально)

Если хотите использовать глубокий анализ:

1. Получите API ключ на https://platform.deepseek.com
2. Добавьте в `.env`:
```env
DEEPSEEK_API_KEY=your_api_key_here
```

Без API ключа AI продолжает работать локально с подсказками и шаблонами.

## Преимущества новой архитектуры

### Старый подход
- Большая боковая панель занимает место
- AI всегда активен и занимает ресурсы
- Каждое действие = вызов LLM
- Высокая стоимость токенов

### Новый подход
- Компактный попап не мешает чтению
- AI вызывается только когда нужен
- 90% работы без LLM
- Практически бесплатно

## Что AI НЕ делает

- Не принимает решения за пользователя
- Не отправляет сообщения автоматически
- Не вмешивается без запроса
- Не использует LLM без явного разрешения

## Что AI делает хорошо

- Помогает не забыть важные детали
- Предлагает профессиональные формулировки
- Подсвечивает риски
- Структурирует договоренности
- Экономит время на рутинных ответах
