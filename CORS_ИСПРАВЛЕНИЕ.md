# Исправление CORS ошибок

## Проблема
Фронтенд не мог подключиться к бэкенду из-за CORS (Cross-Origin Resource Sharing) ошибок.

## Что было исправлено

### 1. Изменения во фронтенде

**API клиент** (`src/core/api.ts`):
- Добавлен `mode: 'cors'` ко всем fetch запросам
- Установлен `credentials: 'omit'` (cookies не используются, только JWT токены)
- Обновлена функция `getApiBaseUrl()` для использования прокси `/api` в режиме разработки

**Конфигурация Vite** (`vite.config.ts`):
- Добавлена настройка прокси для локальной разработки
- Все запросы к `/api/*` проксируются на `https://influo-seven.vercel.app`
- Это устраняет CORS ошибки при локальной разработке

### 2. Изменения в бэкенде

**Production** (`backend/api/index.js`):
- Изменено `credentials: true` на `credentials: false`
- Обновлена конфигурация origins для поддержки всех доменов `.vercel.app`
- Добавлены необходимые CORS заголовки

**Development** (`backend/src/main.ts`):
- Синхронизирована CORS конфигурация с production
- Добавлена поддержка `.vercel.app` доменов

## Как запустить

### Режим разработки

1. Запустите фронтенд:
```bash
npm run dev
```

2. Бэкенд уже развернут на `https://influo-seven.vercel.app`

3. Попробуйте войти в систему - CORS ошибки должны быть устранены

### Production развертывание

#### Развертывание бэкенда
```bash
cd backend
vercel --prod
```

#### Развертывание фронтенда
```bash
vercel --prod
```

## Если CORS ошибки всё ещё возникают

1. **Проверьте переменные окружения бэкенда**
   - Убедитесь, что `FRONTEND_ORIGIN` или `FRONTEND_URL` установлены в Vercel
   - Проверьте логи бэкенда

2. **Очистите кэш браузера**
   - CORS ошибки могут кэшироваться браузером
   - Жесткое обновление: Ctrl+F5 (Windows) или Cmd+Shift+R (Mac)

3. **Проверьте вкладку Network в DevTools**
   - Откройте DevTools → вкладка Network
   - Найдите неудачные запросы
   - Проверьте наличие заголовка `Access-Control-Allow-Origin`

4. **Убедитесь, что бэкенд развернут**
   - Проверьте, что последняя версия кода развернута
   - Протестируйте endpoint `/api/health`

## Измененные файлы

### Фронтенд
- `src/core/api.ts` - CORS конфигурация
- `vite.config.ts` - Прокси для разработки

### Бэкенд
- `backend/api/index.js` - CORS конфигурация для production
- `backend/src/main.ts` - CORS конфигурация для разработки

## Итог

Все CORS проблемы устранены:
- Правильно настроены fetch запросы с CORS режимом
- Настроен прокси для локальной разработки
- Обновлена CORS конфигурация бэкенда
- Удалено ненужное требование `credentials: true`
- Добавлена поддержка всех Vercel доменов

Приложение теперь должно корректно работать как в режиме разработки, так и в production.
